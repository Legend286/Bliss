<Project Sdk="Microsoft.NET.Sdk">

    <!-- Project -->
    <PropertyGroup>
        <TargetFramework>net8.0</TargetFramework>
        <ImplicitUsings>enable</ImplicitUsings>
        <Nullable>enable</Nullable>
        <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    </PropertyGroup>

    <!-- Vulkan SDK -->
    <PropertyGroup>
        <VulkanBinPath>C:\VulkanSDK\1.3.283.0\Bin</VulkanBinPath>
    </PropertyGroup>

    <ItemGroup>
      <Folder Include="CSharp\Audio\" />
    </ItemGroup>

    <!-- Libraries -->
    <ItemGroup>
      <PackageReference Include="Silk.NET.Vulkan.Extensions.EXT" Version="2.21.0" />
      <PackageReference Include="Silk.NET.Vulkan.Extensions.KHR" Version="2.21.0" />
      <PackageReference Include="Silk.NET.Windowing" Version="2.21.0" />
      <PackageReference Include="Silk.NET.Input" Version="2.21.0" />
      <PackageReference Include="Silk.NET.XAudio" Version="2.21.0" />
      <PackageReference Include="Silk.NET.Assimp" Version="2.21.0" />
    </ItemGroup>

    <!-- Shader Stages (Vertex, Fragment...) -->
    <ItemGroup>
        <VertexShader Include="**/*.vert" />
        <FragmentShader Include="**/*.frag" />
    </ItemGroup>
    
    <!-- Content -->
    <ItemGroup>
        <Content Include="content/**/*" Pack="true" Exclude="@(VertexShader);@(FragmentShader);">
            <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
            <PackageCopyToOutput>true</PackageCopyToOutput>
        </Content>
    </ItemGroup>

    <!-- Shader Cleaner -->
    <Target Name="CleanVulkanShader" BeforeTargets="Clean">
        <Message Text="......................................SHADERS.Clean..........................................................." Importance="high" />
        <ItemGroup>
            <FilesToDelete Include="**\*.spv" />
        </ItemGroup>
        <Delete Files="@(FilesToDelete)" />
        <Message Text="......................................SHADERS.Cleaned........................................................." Importance="high" />
    </Target>

    <!-- Shader Compiler -->
    <Target Name="BuildVulkanShader" BeforeTargets="BeforeBuild">
        <Message Text="......................................SHADERS.Compile........................................................." Importance="high" />
        <Message Text="   Starting Vulkan Shader Compilation..." Importance="high" />
        <Message Text="     VulkanBinPath: $(VulkanBinPath)" Importance="high" />
        <Message Text="     VertexShader: @(VertexShader)" Importance="high" />
        <Message Text="     FragmentShader: @(FragmentShader)" Importance="high" />
        <Exec Command="$(VulkanBinPath)\glslc.exe &quot;%(VertexShader.FullPath)&quot; -o &quot;%(VertexShader.FullPath).spv&quot;" Condition="'@(VertexShader)'!=''" />
        <Exec Command="$(VulkanBinPath)\glslc.exe &quot;%(FragmentShader.FullPath)&quot; -o &quot;%(FragmentShader.FullPath).spv&quot;" Condition="'@(FragmentShader)'!=''" />
        <Message Text="......................................SHADERS.Compiled........................................................" Importance="high" />
    </Target>
</Project>
