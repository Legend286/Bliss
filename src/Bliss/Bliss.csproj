<Project Sdk="Microsoft.NET.Sdk">

    <!-- Project -->
    <PropertyGroup>
        <TargetFramework>net8.0</TargetFramework>
        <ImplicitUsings>enable</ImplicitUsings>
        <Nullable>enable</Nullable>
        <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    </PropertyGroup>

    <ItemGroup>
        <Folder Include="CSharp\Audio\" />
    </ItemGroup>
    
    <!-- Libraries -->
    <ItemGroup>
      <PackageReference Include="Silk.NET.Vulkan.Extensions.EXT" Version="2.21.0" />
      <PackageReference Include="Silk.NET.Vulkan.Extensions.KHR" Version="2.21.0" />
      <PackageReference Include="Silk.NET.Windowing" Version="2.21.0" />
      <PackageReference Include="Silk.NET.Input" Version="2.21.0" />
      <PackageReference Include="Silk.NET.XAudio" Version="2.21.0" />
      <PackageReference Include="Silk.NET.Assimp" Version="2.21.0" />
      <PackageReference Include="StbImageSharp" Version="2.27.14" />
    </ItemGroup>

    <!-- _____________________________________Vulkan_____________________________________ -->

    <!-- Vulkan SDK -->
    <PropertyGroup>
        <VulkanBinPath>C:/VulkanSDK/1.3.283.0/Bin</VulkanBinPath>
    </PropertyGroup>

    <!-- _____________________________________Shader_____________________________________ -->

    <!-- Shader Stages (Vertex, Fragment...) -->
    <ItemGroup>
        <VertexShader Include="$(contentFolder)/**/*.vert" Pack="true">
            <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
            <PackageCopyToOutput>true</PackageCopyToOutput>
        </VertexShader>

        <FragmentShader Include="$(contentFolder)/**/*.frag" Pack="true">
            <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
            <PackageCopyToOutput>true</PackageCopyToOutput>
        </FragmentShader>
    </ItemGroup>

    <!-- Shader Cleaner -->
    <Target Name="CleanVulkanShader" BeforeTargets="Clean">
        <Message Text="......................................Shaders Cleaning......................................" Importance="high" />
        <ItemGroup>
            <FilesToDelete Include="$(contentFolder)/**/*.spv" />
        </ItemGroup>
        <Delete Files="@(FilesToDelete)" />
        <Message Text=".......................................Shaders Cleaned......................................" Importance="high" />
    </Target>

    <!-- Shader Compiler -->
    <Target Name="BuildVulkanShader" BeforeTargets="BeforeBuild">
        <Message Text="......................................Shaders Compiling....................................." Importance="high" />
        <Message Text="   Starting Vulkan Shader Compilation..." Importance="high" />
        <Message Text="     > VulkanBinPath: $(VulkanBinPath)" Importance="high" />
        <Message Text="     > VertexShader: @(VertexShader)" Importance="high" />
        <Message Text="     > FragmentShader: @(FragmentShader)" Importance="high" />
        <Exec Command="$(VulkanBinPath)/glslc.exe &quot;%(VertexShader.FullPath)&quot; -o &quot;%(VertexShader.FullPath).spv&quot;" Condition="'@(VertexShader)'!=''" />
        <Exec Command="$(VulkanBinPath)/glslc.exe &quot;%(FragmentShader.FullPath)&quot; -o &quot;%(FragmentShader.FullPath).spv&quot;" Condition="'@(FragmentShader)'!=''" />
        <Message Text="......................................Shaders Compiled......................................" Importance="high" />
    </Target>

    <!-- _____________________________________Content_____________________________________ -->

    <!-- Content Folder -->
    <PropertyGroup>
        <contentFolder>content</contentFolder>
    </PropertyGroup>

    <!-- Content -->
    <ItemGroup>
        <Content Include="$(contentFolder)/**/*" Pack="true" Exclude="@(VertexShader);@(FragmentShader);">
            <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
            <PackageCopyToOutput>true</PackageCopyToOutput>
        </Content>
    </ItemGroup>
</Project>
